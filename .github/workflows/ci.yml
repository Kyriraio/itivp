name: CI for Bets Ministry

on:
  push:
    branches:
      - lab8
  pull_request:
    branches:
      - lab8

jobs:
  build:
    runs-on: windows-latest  # Запуск на виртуальной машине с Windows

    steps:
      # Шаг 1: Получить код
      - name: Checkout code
        uses: actions/checkout@v3

      # Шаг 2: Установить PHP с расширениями, включая ext-fileinfo
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2'
          extensions: ext-fileinfo  # Устанавливаем нужные расширения

      # Шаг 3: Запустить composer update, чтобы обновить lock файл
      - name: Update Composer dependencies
        run: |
          composer update  # Запустим composer update для решения проблем с зависимостями

      # Шаг 4: Установить зависимости через Composer
      - name: Install dependencies
        run: |
          composer install  # Устанавливает зависимости

      # Шаг 5: Запустить тесты с помощью PHPUnit
      - name: Run tests
        run: |
          ./vendor/bin/phpunit tests  # Запускает тесты
